A method to reconstruct full three-dimensional photofragment distributions from their two-dimensional (2D) projection onto a detection plane is presented, for processes in which the expanding Newton sphere has cylindrical symmetry around an axis parallel to the projection plane. The method is based on: (1) onion-peeling in polar coordinates [Zhao et al. Rev. Sci. Instrum. 73, 3044 (2002)] in which the contribution to the 2D projection from events outside the plane bisecting the Newton sphere are subtracted in polar coordinates at incrementally decreasing radii; and (2) ideas borrowed from the basis set expansion (pBASEX) method in polar coordinates [Garcia et al. Rev. Sci. Instrum. 75, 4989 (2004)], which we use to generate 2D projections at each incremental radius for the subtraction. Our method is as good as the pBASEX method in terms of accuracy, is devoid of centerline noise common to reconstruction methods employing Cartesian coordinates; and it is computationally cheap allowing images to be reconstructed as they are being acquired in a typical imaging experiment.
Photofragment imaging 1,2 has become one of the most important experimental techniques in the study of gas-phase molecular dynamics as it provides a simple method to determine the velocity vector of photofragments, be it ions, neutrals, or electrons. Experimentally, the expanding Newton sphere impinges onto a position sensitive detector, typically achieved by accelerating the output from a pair of multichannel plates onto a phosphor screen and using a charge-coupled device (CCD) to capture the image produced. For products that appear with cylindrical symmetry, which is the case with the majority of photodissociation, photoionization and reactive scattering experiments, placement of the detector parallel to this symmetry plane ensures that only this symmetry is collapsed in the subsequent projection. The use of charged-particle imaging in particular has become wide spread with the advent of velocity-map imaging 3 (VMI) in which the velocity components are focused onto a specific point on the detector, regardless of the initial position in space. In this scheme, a gridless Wiley–McLaren-type electrode arrangement produces an electrostatic lens, which can be constructed to provide a focal plane at the detector. VMI is an indispensable experimental tool and has been used in a wide variety of applications . 4 In addition to the measurement of both speed and angular distributions of photofragments, a major advantage of charged-particle imaging is its 4π steradian collection of charged particles and the overall detection efficiency is only limited by the efficiency of the detector. However, under low signal level conditions, the effective efficiency in terms of obtaining a speed or angular distribution is much less. This loss arises from the reduction in dimensionality in the projection of the three-dimensional (3D) expanding Newton sphere onto a two-dimensional (2D) detector. In order to reconstruct the 3D distribution, either a mathematical reconstruction or the use of elegant slice-imaging techniques 5–8 is required. In the latter, only the center slice through the expanding 3D distribution is detected, however, such experiments are generally more involved and very challenging for light particles such as photoelectrons. The loss of “efficiency” is exasperated for photoelectron spectroscopy where the use of the magnetic-bottle allows for near-unit efficiency in producing a photoelectron spectrum ,9 although the loss of angular information and of sensitivity at low speeds make this method restrictive. In general, the direct provision of the speed distribution through time-of-flight methods is very attractive as it provides instant feedback during data acquisition (DAQ). In contrast, the visual inspection of a 2D image during DAQ often does not provide the user with information on the quality of speed or angular distributions. This is in part because at large radii, the signal appears weaker, while the center of the image typically is very bright. Additionally, the 2D image contains the cylindrically symmetric azimuthal contribution, which carries no useful information. As a result, the observation of small signal in congested regions of a radial spectrum can be difficult, as is the case, for example, in time-resolved photoelectron imaging. Hence, access to the radial spectrum during DAQ allows a user to optimize signals and determine the quality of a spectrum, without the need for using an off-line reconstruction method. Motivated by this restriction, we present an image reconstruction routine based on polar onion-peeling (POP), allowing “real-time” image processing while retaining the accuracy of other reconstruction methods. In order to recover the speed and angular distributions from photofragment images, a range of analytical image reconstruction methods have been developed, most of which have been reviewed in Ref. 10. Mathematically, the projection of the 3D distribution onto a 2D plane can be done through the Abel integral and thus, numerical inverse Abel methods can be used to reconstruct the 3D distribution from a measured image, of which the Fourier–Hankel algorithm is most commonly employed. However, the inverse Abel integral is cumbersome and a robust method to circumvent its use directly is to employ basis set functions with analytically known inverse Abel transforms. This basis set expansion (BASEX) method 11 is accurate and can handle relatively noisy images and as a result has been widely adopted. A variation in this method, pBASEX, uses polar basis set functions in which the basis sets include the Legendre polynomials to which the angular distributions of the photofragments are fitted. This has the advantage of producing a reconstructed image in which the centerline noise generated in most reconstruction methods is restricted to the center spot of the image. Additionally, reconstructed images are naturally smoothed, particularly angularly, so that the images are visually very attractive. pBASEX is computationally fast compared to BASEX, inverse Abel methods and the method of Vrakking ,13 which iteratively calculates the 2D projection based on some initial guess. A recent method based on cross validation and iterative regularization combines features of both BASEX and the iterative method. Another approach to the reconstruction problem is the so-called onion-peeling method. The basic premise is that the intensity of a given point on the 2D detector has a contribution from the ϕ-dependence of the original 3D distribution (see Fig. 1). In Cartesian coordinates, this can be calculated along the decreasing x-direction and removed, as long as there is cylindrical symmetry around ϕ. Additionally, the energy of the photoproduct must be much less than the energy gained in the detection, so that the contribution along x has a relatively simple solution. Although this restriction has been overcome ,16 its solution is nontrivial particularly for nonhomogenous electric acceleration fields, as is the case in VMI. The onion-peeling method is appealing because it is intuitively simple and computationally very fast. However, in Cartesian coordinates it suffers from error accumulation because one must start at the outermost point on the detector, where the signal is smallest due to the Jacobian in going from 3D spherical coordinates (the laser-matter interaction system) to 2D Cartesian (the detection system). This problem can be alleviated by onion-peeling in polar coordinates ,17 in which the error at large radii is reduced and error accumulation is not a major concern. Additionally, it relaxes the need for a high kinetic energy at the detector with respect to the initial energy. Like pBASEX and the iterative methods, POP reduces the centerline noise to a spot at the center of the image. However, POP as currently developed is slow, thus loosing a lot of onion-peeling’s appeal. Additionally, POP has not been directly compared to other methods and onion-peeling in general is perceived to be inferior to BASEX and many other methods in terms of accuracy and its handling of noise. In this article, we overcome the limitations of computational speed of POP by employing the basis set concepts of BASEX. Our method is a computationally cheap and an intuitively simple reconstruction method for on-the-fly image reconstruction during DAQ. Additionally, we show that POP is as accurate as pBASEX and has certain important advantages over the latter. The next section describes the method along with computational details. In Sec. III, the method is compared with other methods for images with low signal-to-noise levels and large variations in the intensities of features. It is also tested on an experimentally obtained image. Section IV presents a summary.
With reference Fig. 1, consider a 3D radial distribution F(r,θ,ϕ) that is cylindrically symmetric around the z-axis (for photoionization and photodissociation experiments the z-axis will correspond to the radiation polarization vector). In charged-particle imaging, F(r,θ,ϕ) is mapped onto the 2D plane parallel to z, producing the measured distribution G(R,α). For charged particles emitted with a radial (speed) distribution described by a delta function δ(r) the image G(R,α) has signal at radii smaller than the radius defined by the velocity of the photoproducts (i.e., at R<r). This signal originates from the ϕ-dependence of the charged-particle cloud, which may be calculated and subtracted away from G(R,α), for all R<r leaving only the radial delta function δ(r) at R=r. The resultant distribution is equivalent to a slice through the 3D distribution F(r,θ,ϕ=0) and from this, the full 3D distribution can be recovered because of the inherent cylindrical symmetry around the z-axis of F(r,θ,ϕ). In the case of broad or congested radial distributions, the same strategy holds. The 2D projection G(R,α) can be expressed as the sum of the individual 2D projections g(r;R,α) for all r components of the full 3D distribution F(r,θ,ϕ)G(R,α)=∫0rmaxg(r;R,α)dr,where R≤r and the semicolon in g(r;R,α) is used to indicate that the 2D projections are given at specific radii r. Analogous to the case of the radial delta function, F(r,θ,ϕ=0) can be recovered by removing the contributions of ϕ for R<r, starting at r=rmax and incrementally decreasing in steps of dr until r=0 is reached. At each r, g(r;R,α) is subtracted from G(R,α), which effectively “peels away” the ϕ-contributions at each r. Hence, this method has been termed onion-peeling and it is particularly intuitive in polar coordinates. POP was first introduced by Zhao et al.17 who also present a thorough discussion of the benefits of onion-peeling in polar over Cartesian coordinates. The method presented here is in essence equivalent, however, the main restriction of their method has been its computational expense and general applicability. The cause of this arises from the need to simulate a 3D distribution at each radial increment. The 2D projection of this gfit(r;R,α) is then used in the subtraction. Our method fundamentally differs from that of Zhao et al.17 in how gfit(r;R,α) is generated. In order to retain the low computational expense of onion-peeling, we borrow ideas from the BASEX methods ,11,12 in which basis sets are used in order to fit the experimental 2D data. In a similar spirit, the POP method described here uses the concept of basis sets to allow for very efficient calculation of gfit(r;R,α) as described in Sec. II C.

 In practice, the original Cartesian distribution is converted to polar coordinates by mapping the Cartesian grid defined by the CCD onto a polar array. In order to retain a similar amount of information in polar coordinates, the polar pixel is chosen to be of a similar size as the Cartesian pixel (see Fig. 1). As the differential area remains the same, the number of polar pixels required to define a given R will scale as R. For a quadrant of the Cartesian image, this equates to the integer part of 12π(R+1). The signal in a polar pixel is defined by rotating the polar pixel by α about its pivot. Its fractional overlap with the four surrounding Cartesian pixels and their respective signal intensity is then used to calculate the polar pixel’s intensity. The resulting raw polar image G(R,α) is thus a triangular array because the number of angles α at which pixels can be defined scales linearly with R. Although not the traditional representation of a 2D image, we believe that it provides a much more convenient and intuitive display as one can simply read off the radial distribution along the R-axis and the angular distribution by comparing the signal levels along the angular axis. The main source of error in our conversion arises from the assumption that the polar pixel has the same dimensions as the Cartesian pixel. This becomes less pronounced as R increases and, because the onion-peeling peels from the outer radius inwards, the errors are not cumulative and only present a problem at small R. However, the noise introduced by the reconstruction method is also greatest at small R. Thus, noise accumulation only occurs at small R, and the noise introduced by the polar conversion is not significant.

 The raw polar image G(R,α) corresponds to the sum over all r components as defined in Eq. (1). As long as there is no signal at radii larger than the detector, the outermost ring contains no contribution from ϕ and the substitution,g(r;R,α)=h(r,θ),at r=R is valid. Starting at the outermost radius, h(rmax,θ) is fitted to the well-known angular distribution 18,19I(θ)=N(r)∑nβn(r)Pn[cos(θ)],where Pn[cos(θ)] is the nth order Legendre polynomial. The fit provides N(r), an intensity factor, and βn(r), the anisotropy parameters. The integer n is determined by the physics of the process. The fitting can be performed using standard linear least-squares methods, such as singular value decomposition, as used in pBASEX. In general, our concern is primarily with one- or two-photon processes, hence at present our program only fits up to n=4, where the fit is performed directly. From N(r) and βn(r), the distribution gfit(rmax;R,α) may be calculated, which is then subtracted from G(R,α) for all R≤rmaxG‡(R,α)=G(R,α)−gfit(r;R,α).
G‡(R,α) is a modified image containing G(R,α) for R<rmax. The process is incrementally repeated for r=rmax−dr until r=0 is reached. Upon completion, G‡(R,α) represents a 2D image of all the residuals from the subtraction. The 2D slice F(r,θ,ϕ=0) is constructed by retaining h(r,θ) in Eq. (2) at each increment. Note that either the experimental h(r,θ) or the fitted hfit(r,θ) may be used to reconstruct F(r,θ,ϕ=0). The choice does not affect the ultimate radial spectrum produced, however, the latter smoothes angular noise in a similar manner as pBASEX does and presents visually very attractive images, however it also discards real experimental angular noise. In the interest of computational expense, direct numerical simulation of gfit(r;R,α) is avoided as it is time consuming and is the main limitation to the speed of the routine. The approach taken here uses ideas from BASEX, in which basis functions are used in order to fit the experimental 2D data. For basis functions, POP uses idealized radial distribution functions br(R) produced by angular integration of perfectly isotropic images. To retain consistency with the experimental image acquisition, the basis functions are generated by simulating images at a given r onto a Cartesian grid, transforming to polar form using the method described in Sec. II B and integrating over angle α. The basis set B(r,R) is constructed from basis functions generated at all possible r, and B(r,R) is consequently a 2D triangular array. All basis functions are normalized such that the intensity at r=R is unity. Importantly, B(r,R) is generated once using a stand alone program and then supplied to the reconstruction routine. The overall size of the basis set B(r,R) is determined by the size of the CCD in terms of pixels as used in the experiment and it can readily be extended to subpixel resolution attainable through centroiding of events . 20 During the POP routine, the relevant basis function br(R) is retrieved from the B(r,R) basis set, which is called into memory only once at the start of the routine or a DAQ run and remains in memory for the entire duration of the DAQ. An idealized perfectly isotropic polar image gideal(r;R,α) is then constructed from br(R) usinggideal(r;R,α)=ρ(r,R)br(R).
The number of polar pixels at each R, described in Fig. 1, along with their associated intensities is reintroduced to gideal(r;R,α) through the factor ρ(r,R). Numerically, ρ(r,R) is defined as the ratio of the number of polar pixels at r to R and accounts for the fact that in the polar image, the number of polar pixels changes with respect to R, i.e., the polar image is a 2D triangular array. The idealized image gfit(r;R,α) with experimentally observed anisotropy and intensity is then generated throughgfit(r;R,α)=gideal(r;R,α)N(r)∑nβn(r)Pn[Rrcos(α)],where the parameters N(r) and βn(r) have been obtained from the fitting of the outer ring h(r,θ) to Eq. (3). The factor R/r accounts for the transformation of coordinate system from r, θ, and ϕ to R and α, as represented in Fig. 1. The image gfit(r;R,α) generated through Eq. (6) is identical to that produced via the method implemented by Zhao et al.,17 but has avoided direct simulation of the image as part of the reconstruction, resulting in a much more efficient algorithm. The basis set used in our POP algorithm depends on the experimental resolution of the image captured. For a given CCD, a single B(r,R) can be generated. In contrast, the basis functions in BASEX and pBASEX are defined by the width of the Gaussian function used, which affects the reconstructed 3D distribution and consequently introduces an additional parameter.

 POP subtracts the ϕ-contribution to each ring successively, ultimately leading to the slice F(r,θ,ϕ=0). This is valid if the radial width of each increment tends to zero, i.e., dr→0. Pixilation of the image by the CCD means that at every subtraction, some ϕ-component is not accounted for over the pixel width dR, resulting in the retention of a slice F(r,θ,ϕ∼0). Similar pixilation effects have been noted in Cartesian onion-peeling . 21 Figure 2 explores the general functionality of the missing ϕ-component. Images with a single pixel width radial feature at various r have been simulated (using the same number of events), reconstructed and the resulting radial spectrum scaled using the usual r sin(θ). In Fig. 2, the ratio of the peak intensity at fixed r (arbitrarily chosen as r=200) to the peak intensity at varying r is plotted as a function of r, where the different symbols correspond to different anisotropy parameters of the image. If the slice F(r,θ,ϕ=0) contains no ϕ-component, then the ratio should be unity and independent of r. With reference to Fig. 1, the missing ϕ-component at a given R is perpendicular to the Rα-plane (along the y-direction) and its area will depend on R. To a first approximation, the ϕ-component can be described as a triangle (in the xy-plane), the area of which is proportional to RdR. This scaling is shown in Fig. 2 (with dR=1) as a solid line. Despite the rather rough approximation, it appears to capture the behavior very well particularly at large R. The observed β-dependence at small R originates from the θ-dependence on the omitted volume and can in principle be accounted for. However, in practice, this is cumbersome and ultimately presents only a small error and only at small R, where noise is naturally accumulated using polar reconstruction methods. Thus, in order to reconstruct the full 3D distribution from the F(r,θ,ϕ∼0) slice, a r sin(θ) scaling is used instead of the usual r sin(θ), which accurately recovers the full 3D distribution.
POP OF SAMPLE 
 Our primary motivation for developing POP stems from the desire to observe the radial distribution in conjunction with DAQ. In a typical experiment, DAQ does not require the read-out of the CCD at every shot. Specifically, most ultrafast pump-probe experiments operate at 1 kHz, which far exceeds the read-out rate from most CCDs. Hence, often the CCD is exposed for several shots and data transferred at 1 Hz or less. Because this timescale is comparable to that required for POP, reconstruction may be done in parallel to DAQ, providing direct feedback on the progress of the experiment. We demonstrate the point by simulating a radial spectrum in a typical time-resolved photoelectron imaging experiment. Typically, ∼1 electron/shot is collected at 1 kHz for single photon features (features A and B in Fig. 3), while a pump-probe signal is often an order of magnitude less probable (feature C in Fig. 3). Images in the first column of Fig. 3 are simulated by randomly sampling a 3D distribution of photoproducts with predetermined anisotropy parameters and Gaussian radial distributions. This is then projected onto a 256×256 Cartesian grid, representing the CCD. The three processes, labeled peaks A, B, and C in Fig. 3, correspond to radial distributions centered at r=40, 75, and 90 and anisotropy parameters of β2=−0.5, 1.0, and 0.0, respectively. Also included are 0.5 electrons/shot of random events on the Cartesian grid to simulate the effect of white noise. The first row in Fig. 3 shows the simulation after only 1 s of DAQ, corresponding to 103 electrons in peaks A and B. The central column represents F(r,θ,ϕ=0) following POP and retaining hfit(r,θ). This is displayed in polar coordinates as the triangular array described in Sec. II, where the diagonal corresponds to the angle θ=π/2. For clarity, negative values arising from over subtraction have been set to zero in the display. Despite the low signal level, features A and B can be clearly identified. In the final column, the corresponding radial spectrum is presented along with a three point running average; peaks A and B can be readily identified and hence optimized during DAQ (at a 1 Hz rate). The second row shows the same data, but after 10 s collection, i.e., 104 electrons in A and B. Although it is now also clear from the raw Cartesian image that there are two distinct rings, the radial spectrum shows the additional presence of feature C, which is not immediately apparent from the raw image. At larger radii, the effects of the 5×103 counts of random Cartesian noise result in a rising baseline and an oscillation near the detection edge. These arise as the Cartesian noise does not posses ϕ-contributions. As a result, the first increment over-subtracts, which is compensated for in the next iteration leading to an oscillation in the fit parameter N(r). After 100 s, the radial distribution shows clearly all the features present and F(r,θ,ϕ=0) provides a convenient visual aide to the anisotropy of features A and B. After 1000 s, corresponding to 106 counts in A and B, the effect of smoothing is no longer noticeable. Figure 3 highlights the benefit of direct access to the radial spectrum. As data is collected, even small signals may be observed, allowing real-time optimization of experimental parameters. Additionally, instant information about the quality of the spectrum is provided; it can be seen that after 100 s of collection, the spectrum may be of acceptable quality, whereas after 10 s, it is not and at 1000 s the improving signal-to-noise is no longer noticeable. In many cases the angular distribution is the observable of interest. Although F(r,θ,ϕ=0) provides a visually attractive image and shows the anisotropy clearly, it must be remembered that this is a fit and provides no information about the quality of that fit. During DAQ, POP can provide a convenient measure of the confidence in the measured β parameters. In Fig. 3, for example, the standard deviation in β2 from the fit in Eq. (3) can be calculated directly: at pixel r=75 it is 94.3%, 36.7%, 9.9%, and 3.4% after 1, 10, 100, and 1000 s, respectively. Hence, POP allows the determination of when a target confidence level is reached. More generally, the residuals array G‡(R,α), defined in Eq. (4), can be used to set general predetermined criteria for the quality of an image and its reconstruction. In Figs. 4 and 5, we compare the accuracy of POP against other commonly used methods. Specifically, we have chosen to compare primarily to pBASEX as Garcia et al.12 provide a thorough evaluation of pBASEX relative to the commonly used methods of BASEX and the Abel inverse. In general, pBASEX performs better than the Abel inverse while it is comparable to BASEX, except for images where the anisotropy parameters βn possess noneven integer values of n, for which pBASEX outperforms BASEX. Figure 4(a) shows a simulated image in which a total number of 7.5×105 events have been randomly generated based on predefined angular and radial Gaussian distributions. The angular parameters used for the simulation have been defined in Table I. In addition, 1×105 counts of Cartesian noise have also been added. The reconstructed slice from POP is shown in Fig. 4(b), where the measured h(r,θ) is retained to show the true nature of the measured noise from the raw 2D image. This is in contrast to Fig. 3 and pBASEX, which only show a fit to the data and as a result, these do not provide any indication of the quality of the angular image. Because noneven integer values of n are used for the anisotropy parameters, the angle spanned by the F(r,θ,ϕ=0) is now 0≤θ≤π and is shown in Fig. 4(b). In Fig. 4(c), the recovered radial distribution (normalized to the total integrated intensity) is shown, along with that obtained using pBASEX and the expected radial distribution based on the input parameters of the simulation. Both methods are able to reproduce the radial positions to subpixel resolution. Similarly, the extracted β parameters, presented in Table I, are accurate to less than one decimal place in both cases. The major noticeable difference in the spectra of Fig. 4(c) is the peak intensities of the peaks around r=95, which is highlighted in the inset. POP appears to do better in terms of absolute peak height and width, reproducing the expected distribution more closely than pBASEX. The other noticeable difference is that the baseline noise between features is less for pBASEX, which is a consequence of the radial width of the Gaussian function contained in the basis set, which essentially smoothes the image. In Fig. 5, an experimentally measured image has been reconstructed using POP and pBASEX to provide the radial spectra shown. The image measured by the Bellm and Reid22 has been produced by resonance-enhanced multiphoton ionization from the S0 ground state, via the 51 vibrational level in the S1 state in para-difluorobenzene. This particular image was chosen as it was used as a direct comparison to time-of-flight data and was also used by Garcia et al. in their evaluation of pBASEX (Fig. 5 in Ref. 12) with respect to the Abel inverse and BASEX methods (Table III in Ref. 12). Radial spectra obtained using either POP or pBASEX produce very similar results both in terms of peak positions and intensities. The anisotropy parameters extracted from POP can be compared directly with those presented by Garcia et al.12 and Bellm and Reid22 and are shown in Table II. POP obtains consistent values with other methods, including the time-of-flight measurements of Bellm and Reid. The computational speed of POP scales as R3. For a 256×256 image POP takes 0.6 s on a PC with a 2.0 GHz processor. The speed of the algorithm can be further improved in a number of ways. For example, the Cartesian-to-polar image conversion, producing G(R,α), can be binned into larger α or R intervals. The binning in larger α intervals is particularly useful. The effective box-car averaging over α only has a minor effect on the angular fit to Eq. (3) (the anisotropy parameters will be slightly underestimated, which can be compensated for), particularly when low order anisotropy terms are required. The increase in computational speed would scale linearly in this case. Binning in larger R intervals would increase the speed significantly (i.e., a 2 pixel bin would lead to a 23-fold increase in computation speed). However, this would also lead to a loss of radial resolution, which may or may not be a major concern, depending on specific applications. Generally, if POP is used as a diagnostic tool during DAQ, rebinning in larger R bins is ideal and allows for true real-time image processing during DAQ. Our code has been developed as a drop-in subroutine in LABVIEW 8.5. Most coding has however been written using C language syntax within a formula node interface for clarity and versatility to any potential user. The LABVIEW platform allows for parallelization of the DAQ and image reconstruction using a dual core processor, common to most modern PCs. The source code is freely available both as a drop-in sub-VI and as a C-SYNTAX code, which can easily be adapted and incorporated in DAQ systems . 23 A very attractive feature of the current method is that it is intuitive, simple, and accessible to experimentalists.
In summary, we have developed a method to reconstruct the full 3D distribution from its 2D projection as measured in velocity-map imaging experiments. It is based on the method of Zhao et al.,17 which performs an onion-peeling of the projection in polar coordinates, but has been greatly improved in terms of computational speed by using a basis set of radial distribution functions, which allow for the efficient calculation of 2D projections required in the onion-peeling subtraction. As a result, POP can be used for the reconstruction of the full 3D Newton sphere alongside DAQ in typical experiments, providing a user with instant, on-the-fly access to the one-dimensional radial and angular spectra rather than the convoluted 2D image. This is particularly useful in applications where signals are small or obscured by large backgrounds, or in applications requiring long DAQ times, both of which are often the case in time-resolved experiments. Despite the improvements in computational speed, the quality of the reconstruction is comparable to the widely used pBASEX method.